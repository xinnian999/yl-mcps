---
description: 智能提交评审工作流 - 通过组合Git命令实现智能提交评审
auto_execution_mode: 1
---

# 智能提交评审工作流

这个工作流通过组合多个 `git_command` 调用来实现智能提交评审功能，替代单独的 `git_smart_review` 工具。

## 工作流步骤

### 1. 检查工作区状态
首先检查当前工作区的状态，确保有文件需要提交：

```bash
git status --porcelain
```

### 2. 获取当前分支信息（如果未指定目标分支）
// turbo
获取当前分支名称作为默认目标分支：

```bash
git branch --show-current
```

### 3. 添加所有更改到暂存区
// turbo
将所有修改的文件添加到暂存区：

```bash
git add .
```

### 4. 获取暂存区文件列表
// turbo
获取暂存区中的文件列表，用于生成提交信息：

```bash
git diff --cached --name-only
```

### 5. 执行提交
使用卡片代号和AI分析生成的提交信息执行提交：

```bash
git commit -m "[卡片代号] [AI生成的描述]"
```

### 6. 推送到评审分支
推送到Gerrit评审分支（refs/for/目标分支）：

```bash
git push origin HEAD:refs/for/[目标分支]
```

## AI智能分析逻辑

AI会根据以下规则分析文件变更并生成提交描述：

1. **文件类型分析**:
   - JavaScript/TypeScript文件 (js, ts, jsx, tsx, vue) → "更新业务逻辑"
   - 样式文件 (css, scss, less) → "调整样式"
   - HTML文件 → "修改页面结构"
   - 配置文件 (json) → "更新配置"
   - 文档文件 (md) → "更新文档"
   - 其他文件 → "代码优化"

2. **组合描述**: 多种文件类型会组合描述，如"更新业务逻辑、调整样式"

3. **提交格式**: `[卡片代号] [描述]`，例如：`bdife-3679 更新业务逻辑、调整样式`

## 使用说明

1. **参数要求**:
   - `card_number`: 必需，卡片代号（如：bdife-3679）
   - `target_branch`: 可选，目标分支（默认使用当前分支）

2. **执行流程**:
   - 检查工作区是否有变更
   - 自动添加所有文件到暂存区
   - 分析文件类型生成智能提交信息
   - 推送到Gerrit评审分支

3. **错误处理**:
   - 如果工作区没有变更，会提示错误
   - 如果推送失败，会显示详细错误信息

## 优势

- **模块化**: 每个步骤都是独立的Git命令，易于理解和调试
- **智能化**: AI自动分析文件变更生成合适的提交信息
- **透明性**: 用户可以清楚看到每个执行的Git命令
- **安全性**: 利用现有的Git命令安全验证机制
- **Gerrit集成**: 直接推送到Gerrit评审分支

## 注意事项

- 确保在正确的Git仓库目录中执行
- 确保有权限推送到目标分支的评审分支
- 卡片代号格式应符合项目规范
- 如果推送失败，请检查网络连接和权限设置