---
description: 智能提交工作流（增强版）
auto_execution_mode: 1
---

# 智能提交工作流（增强版）

这个工作流通过组合多个 `git_command` 调用来实现智能提交功能，支持灵活的提交模式

## 参数说明

此工作流支持以下参数：

- `staged_only` (boolean, 可选): 
  - `true`: 只提交暂存区的改动，不自动添加工作区的文件
  - `false` 或未设置: 自动添加所有工作区改动到暂存区并提交（默认行为）

## 使用方式

### 默认模式：提交所有改动
直接使用斜杠命令或告诉AI执行工作流：
```
/git-smart-push-enhanced
```
或者：
```
请执行智能提交工作流，提交所有改动
```

### 只提交暂存区改动
告诉AI你只想提交暂存区的内容：
```
请执行智能提交工作流，但只提交暂存区的改动
```
或者：
```
执行 git-smart-push-enhanced，staged_only 模式
```


## 工作流步骤

### 1. 检查工作区状态
首先检查当前工作区的状态，了解有哪些文件被修改：

```bash
git status --porcelain
```

### 2. 条件性添加文件到暂存区
根据 `staged_only` 参数决定是否添加文件：

**如果 `staged_only` 为 false 或未设置：**
// turbo
将所有修改的文件添加到暂存区：

```bash
git add .
```

**如果 `staged_only` 为 true：**
跳过此步骤，只使用已经在暂存区的文件

### 3. 验证暂存区内容
// turbo
检查暂存区中的文件，确保有内容可以提交：

```bash
git diff --cached --name-only
```

### 4. 检查暂存区是否为空
如果暂存区为空，根据模式给出不同的提示：

**staged_only 模式下暂存区为空：**
```
错误：暂存区为空，请先使用 git add 添加要提交的文件
```

**非 staged_only 模式下暂存区为空：**
```
提示：工作区没有检测到需要提交的更改
```

### 5. 执行提交
使用AI生成的提交信息执行提交：

```bash
git commit -m "[AI生成的提交信息]"
```

### 6. 推送到远程仓库
// turbo
尝试推送到远程仓库：

```bash
git push
```

### 7. 处理上游分支（如果需要）
如果推送失败因为没有设置上游分支，则设置上游分支并推送：

```bash
git branch --show-current
git push --set-upstream origin [当前分支名]
```

## 使用场景

### 场景1：快速提交所有改动
适用于开发过程中需要快速提交所有工作区改动的情况：
```
/git-smart-push-enhanced
```
或者直接说：
```
帮我提交所有改动并推送
```

### 场景2：精确控制提交内容
适用于需要精确控制提交内容，只提交已经仔细选择并添加到暂存区的文件：
```bash
# 先手动添加特定文件
git add src/specific-file.js
git add docs/readme.md
```
然后告诉AI：
```
请执行智能提交工作流，只提交暂存区的改动
```

### 场景3：部分提交工作流
在大型重构或功能开发中，可能需要将改动分成多个逻辑提交：
```bash
# 第一次提交：只提交核心逻辑
git add src/core/
```
```
请执行智能提交，只提交暂存区内容
```
```bash
# 第二次提交：提交测试文件  
git add tests/
```
```
再次执行智能提交，只提交暂存区内容
```

## 使用说明

1. **AI分析**: AI会分析要提交的更改，根据文件类型和修改内容生成合适的提交信息
2. **灵活模式**: 支持两种提交模式，满足不同的工作流需求
3. **自动处理**: 工作流会自动处理文件添加、提交和推送
4. **错误处理**: 如果推送失败，会自动尝试设置上游分支
5. **状态反馈**: 每个步骤都会提供详细的状态反馈
6. **安全检查**: 在 staged_only 模式下会检查暂存区是否为空

## 优势

- **模块化**: 每个步骤都是独立的Git命令，易于理解和调试
- **灵活性**: 支持两种提交模式，可以根据需要调整工作流
- **透明性**: 用户可以清楚看到每个执行的Git命令
- **安全性**: 利用现有的Git命令安全验证机制
- **精确控制**: staged_only 模式允许精确控制提交内容

## 注意事项

- 确保在正确的Git仓库目录中执行
- 在 `staged_only` 模式下，请确保已经使用 `git add` 添加了要提交的文件
- 提交前请确认要提交的文件内容
- 如果有冲突或其他问题，工作流会停止并提供错误信息
- AI生成的提交信息会根据实际的文件变更内容进行优化
